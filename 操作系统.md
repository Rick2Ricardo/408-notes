# 操作系统

## 一、操作系统概述

### 1、操作系统的概念（定义）功能和目标

#### 操作系统的概念（定义）

**操作系统**(Operating System，OS），是指**控制**和**管理**整个计算机系统和硬件和软件资源，并合理地组织调度计算机的工作和资源分配；以**提供给用户和其他软件方便的接口和环境**；它是计算机系统中最基本的**系统软件**。

##### （1）作为系统资源的管理者

**提供的功能：**

+ 处理机管理
+ 存储器管理
+ 文件管理
+ 设备管理

**目标：**安全有效

**补充知识：**执行一个程序前需要将该程序放到内存当中，才能被CPU出处理

##### （2）向上层提供方便易用的服务

封装思想：操作系统把一些丑陋的硬件功能封装成简单易用的服务，使得用户能更方便地使用计算机，用户无需关心底层硬件原理，只需要对操作系统底层发出命令即可。

**GUI：图形化用户接口（Graphical User Interface）**

用户可以使用形象的图形化界面进行操作，而不再需要记忆复杂的命令、参数。

**联机命令接口**

实例（windows系统） 联机命令接口=交互式命令接口

**特点：**用户说一句，系统跟着做一句

**脱机命令接口**

实例（Windows系统） 脱机命令接口=批处理命令接口

**特点**：用户说一堆，系统跟着做一堆

**程序接口**

可以在程序中进行系统调用来使用程序接口，普通用户不能直接使用程序接口，只能通过程序代码间接使用。

**如：**写C语言“Hello world”时，在printf函数底层就使用到了操作系统提供的显式相关的“系统调用”

在有的教材当中：系统调用=广义指令

##### （3）作为最接近硬件的层次

没有任何软件支持的计算机称作裸机。在裸机上安装的操作系统，可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能更强、使用更加方便的机器。

操作系统对硬件机器的拓展：将CPU、内存、磁盘、显示器、键盘等硬件合理地组织起来，让各种硬件能够互相协调配合，实现更多更复杂的功能。

### 2、操作系统的四个特征

并发、共享、虚拟、异步（并发和共享是最基本的特征，二者互为存在条件）

#### 并发

**概念：**指两个或多个事件在同一时间间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的。

常考易混淆的概念----并行：指两个或多个事件在同一时刻同时发生。

**并发vs并行**

**操作系统的并发性**指计算机系统中“同时”运行着多个程序，这些程序宏观上看是同时运行的，而微观上看是交替运行的。

操作系统就是伴随着“多道程序技术”而出现的。因此，**操作系统和程序并发是一起诞生的。**

**重要考点**：

**单核CPU**同一时刻只能执行一个程序，各个程序只能并发地执行

**多核CPU**同一时刻可以同时执行多个程序，多个程序可以并行地执行

比如Intel的第八代i3处理器就是**4核CPU**，意味着可以**并行地执行4个程序**

#### 共享

**概念：**共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用

**互斥共享方式：**系统中的某些资源，虽然可以提供给多个进程使用，但一个时间段内只允许一个进程访问该资源

+ 例：使用QQ和微信视频，同一时间段内摄像头只能分配给其中一个进程

**同时共享方式：**系统中的某些资源，允许一个时间段内由多个进程“同时”对它们进行访问

+ 使用QQ发送文件A，同时使用微信发送文件B。宏观上看，两边都在同时读取并发送文件，说明两个进程都在访问硬盘资源，从中读取数据。微观上看，两个进程是交替着访问硬盘的。

**注意：**

+ 如果失去并发性，则系统中只有一个程序正在运行，则共享性失去存在的意义
+ 如果失去共享性，则微信不能同时访问硬盘资源，就无法实现同时发送文件，也就无法并发

#### 虚拟

**概念：**虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上对应物（后者）是用户感受到的。

**空分复用技术**----虚拟存储器

**时分复用技术**----虚拟处理器技术：虽然只有一个CPU，但是能同时运行多个程序，微观上处理机在各个微小的时间段内交替着为各个进程服务。

注意：

+ 如果失去了并发性，则一个时间段内系统中只需运行一道程序，那么就失去了实现虚拟性的意义了。因此，没有并发性，就谈不上虚拟性

#### 异步

**概念：**异步是指在多少程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是程序的异步性。

由于并发运行的程序会争抢着使用系统资源，而系统中的资源有限，因此进程的执行不是一贯到底地，而是走走停停的，以不可预知的速度向前推进。

**注意：**

+ 如果失去了并发性，即系统只能串行地运行各个程序，那么每个程序的执行会一贯到底。**只有系统拥有并发性，才有可能导致异步性。**

### 3、操作系统的发展与分类

####  （1）手工操作阶段 

![image-20240619105709383](操作系统.assets/image-20240619105709383.png)

**主要缺点：**用户独占全机、人机速度矛盾导致资源利用率极低

#### （2）批处理阶段----单道批处理系统

引入脱机输入/输出技术，并由监督程序负责控制作业的输入输出

![image-20240619110053360](操作系统.assets/image-20240619110053360.png)

**主要优点：**缓解了一定程度的人机速度矛盾，资源利用率有所提升。

**主要缺点：**内存中仅能有一道程序运行，只有该程序运行结束之后才能调入下一道程序。CPU有大量的时间是在空闲等待I/O完成。资源利用率依然很低。

### 4、操作系统的运行机制

预备知识：程序是如何运行的？

由高级语言翻译为机器指令，程序运行的过程其实就是CPU执行一条一条的机器指令的过程

#### （1）内核程序和应用程序

我们普通程序员写的程序就是”**应用程序**“

微软、苹果由一帮人负责实现操作系统，他们写的就是”**内核程序**“

#### （2）特权指令和非特权指令

应用程序只能使用“**非特权指令**”如：加法指令、减法指令等

操作系统内核作为”管理者“有时候会让CPU执行一些”**特权指令**“，如：内存清零指令。这些指令影响重大，只允许”管理者”-----即操作系统内核来使用

#### （3）内核态和用户态

CPU有两种状态，“内核态”和“用户态”

处于**内核态**时，说明此时正在运行的是**内核程序**，此时可以执行**特权指令**。

处于**用户态**时，说明此时正在运行的是**应用程序**，此时只能执行**非特权指令**。

#### （4）内核

内核是操作系统最重要的核心部分。

很多内核程序组成操作系统内核

#### （5）内核态、用户态的切换

**内核态-->用户态**：执行一条特权指令----修改PSW的标志位为“用户态”。这个动作意味着操作系统将主动让出CPU使用权

**用户态-->内核态**：由“中断”引发，硬件中断信号意味着操作系统将强行夺回CPU的使用权

### 5、中断和异常

#### （1）中断的作用

CPU上会运行两种程序，一种是操作系统内核程序，一种是应用程序。

“中断”是**让操作系统内核夺回CPU使用权**的唯一途径

如果没有“中断”机制，那么一旦应用程序上CPU运行，CPU就会一直运行这个应用程序(既然如此，何来“并发”)。

#### （2）中断的类型

**内中断(也称异常、例外)**

例1：试图在用户态下执行特权指令

例2：执行除法指令时发现除数为0

例3：有时候应用程序想要请求操作系统内核的服务，此时会执行一条特殊的指令--陷入指令，该指令会引发一个内部中断信号

注：

+ 执行“陷入指令”，意味着应用程序主动地将CPU控制权还给操作系统内核。“系统调用”就是通过陷入指令完成地。
+ 与当前执行的指令有关，中断信号来自CPU内部

**外中断（也称“中断”）**

例1：时钟中断----由时钟部件发来的中断信号（使得多个程序并发运行）

例2：I/O中断----由输入/输出设备发来的中断信号（当输入输出任务完成时，向CPU发出中断信号）

注：

+ 每一条指令执行结束，CPU都会例行检查是否有外中断信号
+ 与当前执行的指令无关，中断信号来源于CPU外部

#### （3）中断机制的基本原理

不同的中断信号，需要不同的中断处理程序来处理。当CPU检测到中断信号后，会根据中断信号的类型去查询“**中断向量表**”，以此来找到相应的中断处理程序在内存中的存放位置。

显然，中断程序一定是内核程序，需要运行在“内核态”

#### 6、系统调用